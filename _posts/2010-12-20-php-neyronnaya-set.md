---
layout: post
title: php нейронная сеть
permalink: /168
tags: [ai, neural, neuralnetwork, php]
---

Важно, на вход могут подаваться только 1,0

Не забываем менять размерность.

    <?
        /**
         * простой перцептрон.
         *
         */
        class Perceptron
        {
         private $W;     // веса
         private $size;    // размерность
         private $porog;    // порог

         /**
          * Спрашиваем перцетрон.
          * Иначе говоря функция активации
          *
          * @param array $vector
          * @return int
          */
         public function ask($vector)
         {
             $sum = 0;
             for($i=0;$i<count($vector);$i++)
             {
                 $sum += $vector[$i]*$this->W[$i];
             }
             if($sum > $this->porog) return 1;
             return -1;
         }

         /**
          * Конструктор
          * Аргумент - размерность перцептрона
          *
          * @param int $n
          */
         public function __construct($n)
         {
             $this->size    = $n;
             $this->porog    = 100;
             $this->init_weight();
         }

         /**
          * Инициализация начальных весов.
          * Рандом
          *
          */
         public function init_weight()
         {
             for($i=0;$i<$this->size;$i++) $this->W[] = rand(0, 10);
         }

         /**
          * Сохраняем в файл
          * Если файл есть - перезапишет
          *
          * @param string $filename
          */
         public function weight_save($filename)
         {
                 $serialize = serialize($this->W);
                 fwrite( fopen($filename,"w"), $serialize);
         }

         /**
          * Грузим весы из файла
          *
          *
          * @param string $filename
          */
         public function weight_load($filename)
         {
             $this->W = unserialize(file_get_contents($filename));

         }

         public function teach($vector, $d)
         {
             if($d!=$this->ask($vector))
             {
                 // teach
                 for($i=0;$i<$this->size;$i++)
                 {
                     $this->W[$i] += $d*$vector[$i];
                 }
             }
         }
        }

    /**
     * Example
     */
        $filename = 'w1.txt';

        /**
         * Наш перцептрон будет говорить что дали на вход, квадрат или прямую.
         * Следует учесть, что в этом примере перцептрона спрашивают
         * о том, чего небыло в учении.
         */

        $neural = new Perceptron(64);    // матрица будет 8х8, размерность 64.

        if(!isset($filename))
        {

         /**
          * Учим квадраты
          */
         $v1 =    array(1, 1, 1, 1, 1, 1, 1, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    );
         $neural->teach( $v1, 1 );
         $v1 =    array(0, 1, 1, 1, 1, 1, 1, 1,
                    0, 1, 0, 0, 0, 0, 0, 1,
                    0, 1, 0, 0, 0, 0, 0, 1,
                    0, 1, 0, 0, 0, 0, 0, 1,
                    0, 1, 0, 0, 0, 0, 0, 1,
                    0, 1, 0, 0, 0, 0, 0, 1,
                    0, 1, 0, 0, 0, 0, 0, 1,
                    0, 1, 1, 1, 1, 1, 1, 1,
                    );
         $neural->teach( $v1, 1 );
         $v1 =    array(0, 0, 0, 0, 0, 0, 0, 0,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    );
         $neural->teach( $v1, 1 );
         $v1 =    array(0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    );
         $neural->teach( $v1, 1 );
         $v1 =    array(0, 0, 1, 1, 1, 1, 1, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 1, 1, 1, 1, 1,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    );
         $neural->teach( $v1, 1 );
         $v1 =    array(1, 1, 1, 1, 1, 1, 1, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 0, 0, 0, 0, 0, 0, 1,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    );
         $neural->teach( $v1, 1 );

         /**
          * Теперь учим прямые.
          */
         $v1 =    array(1, 1, 1, 1, 1, 1, 1, 1,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    );
         $neural->teach( $v1,-1 );

         $v1 =    array(0, 0, 0, 0, 0, 0, 0, 1,
                    0, 0, 0, 0, 0, 0, 1, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 1, 0, 0, 0,
                    0, 0, 0, 1, 0, 0, 0, 0,
                    0, 0, 1, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    1, 0, 0, 0, 0, 0, 0, 0,
                    );
         $neural->teach( $v1,-1 );

         $v1 =    array(0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    );
         $neural->teach( $v1, -1 );

         $v1 =    array(0, 1, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    );
         $neural->teach( $v1,-1 );

         $v1 =    array(1, 0, 0, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    0, 0, 1, 0, 0, 0, 0, 0,
                    0, 0, 0, 1, 0, 0, 0, 0,
                    0, 0, 0, 0, 1, 0, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 0, 1, 0,
                    0, 0, 0, 0, 0, 0, 0, 1,
                    );
         $neural->teach( $v1,-1 );

         $v1 =    array(0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    0, 0, 0, 0, 0, 1, 0, 0,
                    );
         $neural->teach( $v1,-1 );

         /**
          * Выучили небольшой выборкой.
          * Запишем веса в файл.
          */

         $neural->weight_save("w1.txt");
        }
        else
        {
         // Чтобы каждый раз не учится, грузим.
         $neural->weight_load($filename);;
        }

        // Даем на вход квадрат, которого нету в выборке
         $v1 =    array(0, 0, 1, 1, 1, 1, 1, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 0, 0, 0, 0, 1,
                    0, 0, 1, 1, 1, 1, 1, 1,
                    );
        echo $neural->ask( $v1 )==1?"Квадратик":"прямая";
        echo "<br />";
        // Еще один
         $v1 =    array(0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 1, 1, 1, 1, 1, 0,
                    0, 0, 1, 0, 0, 0, 1, 0,
                    0, 0, 1, 0, 0, 0, 1, 0,
                    0, 0, 1, 0, 0, 0, 1, 0,
                    0, 0, 1, 0, 0, 0, 1, 0,
                    0, 0, 1, 1, 1, 1, 1, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    );
        echo $neural->ask( $v1 )==1?"Квадратик":"прямая";
        echo "<br />";

        // Теперь спросим про линии
         $v1 =    array(0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    1, 1, 1, 1, 1, 1, 1, 1,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    );

        echo $neural->ask( $v1 )==1?"Квадратик":"прямая";
        echo "<br />";

         // Здесь просим про прямую длиной 5, а не 8.
         $v1 =    array(0, 0, 0, 0, 1, 0, 0, 0,
                    0, 0, 0, 1, 0, 0, 0, 0,
                    0, 0, 1, 0, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0, 0,
                    1, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0,
                    );

        echo $neural->ask( $v1 )==1?"Квадратик":"прямая";
        echo "<br />";
